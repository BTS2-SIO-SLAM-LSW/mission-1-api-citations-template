<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä √âvaluation Mission 1 - G√©n√©rateur de Citations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: system-ui, sans-serif; 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #333; 
            padding: 1rem; 
            line-height: 1.6;
            min-height: 100vh;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #3b82f6, #1e40af); 
            color: white; 
            padding: 2rem; 
            text-align: center; 
            position: relative;
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: #ffd700;
            transition: width 0.3s ease;
        }
        .content { padding: 2rem; }
        .section { 
            margin-bottom: 2rem; 
            padding: 1.5rem; 
            background: #f8fafc; 
            border-radius: 12px; 
            border-left: 4px solid #3b82f6;
        }
        .section h2 { 
            color: #1f2937; 
            margin-bottom: 1rem; 
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .section h3 {
            color: #3b82f6; 
            margin: 1.5rem 0 1rem 0;
            font-size: 1.1rem;
        }
        .alert { 
            background: linear-gradient(135deg, #dbeafe, #bfdbfe); 
            color: #1e40af; 
            padding: 1.5rem; 
            border-radius: 12px; 
            margin-bottom: 1.5rem;
            border: 1px solid #93c5fd;
            position: relative;
        }
        .alert::before {
            content: "‚ÑπÔ∏è";
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }
        .form-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 1rem; 
            margin-bottom: 1rem; 
        }
        .form-group { margin-bottom: 1rem; }
        label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 0.5rem; 
            color: #374151; 
        }
        input, select, textarea { 
            width: 100%; 
            padding: 0.875rem; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            font-size: 1rem; 
            transition: all 0.2s;
            background: white;
        }
        input:focus, select:focus, textarea:focus { 
            outline: none; 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        textarea { 
            min-height: 80px; 
            resize: vertical; 
            font-family: inherit;
        }
        .btn { 
            padding: 1rem 2rem; 
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white; 
            border: none; 
            border-radius: 12px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        .btn-success { 
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .btn-success:hover { 
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }
        .score { 
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            padding: 1.5rem; 
            border-radius: 12px; 
            text-align: center; 
            font-weight: 700; 
            color: #1e40af; 
            margin-top: 1rem;
            font-size: 1.2rem;
            border: 2px solid #93c5fd;
        }
        .score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        .score-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .checkbox-group { display: grid; gap: 0.75rem; }
        .outils-multi-col {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }
        .checkbox-item { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            padding: 1rem; 
            background: white; 
            border-radius: 8px; 
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #e5e7eb;
        }
        .checkbox-item:hover {
            border-color: #3b82f6;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .checkbox-item input[type="checkbox"] { 
            width: auto; 
            margin: 0;
            transform: scale(1.2);
        }
        .qcm-question { 
            background: white;
            padding: 1.5rem; 
            border-radius: 12px; 
            margin-bottom: 1.5rem; 
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        .qcm-question:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .qcm-question h4 { 
            color: #1f2937; 
            margin-bottom: 1rem; 
            font-size: 1.1rem; 
            line-height: 1.4;
            font-weight: 600;
        }
        .compact-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        .radio-group { 
            display: grid; 
            gap: 0.5rem; 
            margin: 1rem 0; 
        }
        .radio-item { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            padding: 0.875rem; 
            background: #f8fafc; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 0.95rem;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        .radio-item:hover { 
            background: #f0f9ff; 
            border-color: #3b82f6;
        }
        .radio-item input[type="radio"] { 
            width: auto; 
            margin: 0;
            transform: scale(1.1);
        }
        .actions { 
            display: flex; 
            gap: 1rem; 
            justify-content: center; 
            padding: 2rem; 
            background: #f8fafc;
            flex-wrap: wrap;
        }
        .json-output { 
            background: #1e293b; 
            color: #f1f5f9; 
            padding: 1.5rem; 
            border-radius: 12px; 
            font-family: 'JetBrains Mono', 'Fira Code', monospace; 
            font-size: 0.875rem; 
            max-height: 400px; 
            overflow-y: auto; 
            white-space: pre-wrap; 
            margin-top: 1rem;
            border: 2px solid #334155;
        }
        .etape-item {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 2px solid #e5e7eb;
            transition: all 0.2s;
        }
        .etape-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .etape-item h4 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .concepts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .help-tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        .help-tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #1f2937;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
        }
        .help-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .validation-message {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.875rem;
            display: none;
        }
        .validation-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .validation-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .auto-save-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .auto-save-indicator.show {
            opacity: 1;
        }
        @media (max-width: 768px) { 
            .form-row { grid-template-columns: 1fr; } 
            .actions { flex-direction: column; align-items: center; }
            .compact-options { grid-template-columns: 1fr; }
            .concepts-grid { grid-template-columns: 1fr; }
            .outils-multi-col { grid-template-columns: 1fr; }
            .score-details { grid-template-columns: 1fr; }
            .header h1 { font-size: 2rem; }
            .container { margin: 0.5rem; }
        }
    </style>
</head>
<body>
    <div class="auto-save-indicator" id="autoSaveIndicator">üíæ Sauvegard√© automatiquement</div>
    
    <div class="container">
        <div class="header">
            <h1>üìä √âvaluation Mission 1</h1>
            <p>G√©n√©rateur de Citations avec API REST - Auto-√©valuation Interactive</p>
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="content">
            <!-- Info Section -->
            <div class="alert">
                <strong>Guide d'utilisation :</strong> 
                Compl√©tez chaque section √† votre rythme. Vos r√©ponses sont sauvegard√©es automatiquement. 
                Les informations √©tudiant (nom, pr√©nom, repository) seront remplies automatiquement lors de la collecte des r√©sultats.
            </div>

            <!-- Section QCM -->
            <div class="section" id="qcm-section">
                <h2>üìö <span>Questionnaire de Validation</span> 
                    <span class="help-tooltip">‚ùì
                        <span class="tooltip-text">Testez vos connaissances acquises pendant la mission</span>
                    </span>
                </h2>
                <p style="margin-bottom: 1.5rem; color: #6b7280;">
                    <strong>Instructions :</strong> S√©lectionnez la meilleure r√©ponse pour chaque question. 
                    Justifiez vos choix pour valider votre compr√©hension.
                </p>
                <div id="qcm-container"></div>
            </div>

            <!-- Section Technique -->
            <div class="section" id="technical-section">
                <h2>‚ö° <span>Auto-√©valuation Technique</span>
                    <span class="help-tooltip">‚ùì
                        <span class="tooltip-text">Cochez les fonctionnalit√©s que vous avez r√©ussies</span>
                    </span>
                </h2>
                <h3>üîß Fonctionnalit√©s Obligatoires (15 pts)</h3>
                <div class="checkbox-group" id="obligatoire-container"></div>
                
                <h3>üåü Fonctionnalit√©s Bonus (9 pts)</h3>
                <div class="checkbox-group" id="bonus-container"></div>
                
                <div class="score" id="score-display">
                    <div>Score Total: 0/42 points (0/20)</div>
                    <div class="score-details" id="score-details"></div>
                </div>
            </div>

            <!-- Section Progression -->
            <div class="section" id="progression-section">
                <h2>üìà <span>Progression et Apprentissage</span>
                    <span class="help-tooltip">‚ùì
                        <span class="tooltip-text">R√©flexion sur votre parcours d'apprentissage</span>
                    </span>
                </h2>
                
                <h3>üéØ √âtapes R√©alis√©es</h3>
                <div id="etapes-container"></div>
                
                <h3>üí° Concepts Techniques Ma√Ætris√©s</h3>
                <div class="concepts-grid" id="concepts-container"></div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ü§î Concepts √† approfondir</label>
                        <textarea id="concepts_a_revoir" placeholder="Ex: async/await, gestion d'erreurs, CSS Grid..." maxlength="500"></textarea>
                        <small style="color: #6b7280;">Listez les sujets que vous souhaitez retravailler</small>
                    </div>
                    <div class="form-group">
                        <label>üöß Principales difficult√©s rencontr√©es</label>
                        <textarea id="difficultes_rencontrees" placeholder="Ex: Compr√©hension des Promises, debug des erreurs API..." maxlength="500"></textarea>
                        <small style="color: #6b7280;">D√©crivez vos blocages principaux</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>üí™ Points forts identifi√©s</label>
                        <textarea id="points_forts_identifies" placeholder="Ex: Logique JavaScript, r√©solution de probl√®mes..." maxlength="500"></textarea>
                        <small style="color: #6b7280;">Vos facilit√©s et r√©ussites</small>
                    </div>
                    <div class="form-group">
                        <label>üéØ Objectifs d'am√©lioration</label>
                        <textarea id="ameliorations_souhaitees" placeholder="Ex: Ma√Ætriser les APIs plus complexes, am√©liorer le CSS..." maxlength="500"></textarea>
                        <small style="color: #6b7280;">Ce sur quoi vous voulez progresser</small>
                    </div>
                </div>
            </div>

            <!-- Section R√©flexion -->
            <div class="section" id="reflexion-section">
                <h2>üí≠ <span>R√©flexion P√©dagogique</span>
                    <span class="help-tooltip">‚ùì
                        <span class="tooltip-text">Votre retour sur l'exercice pour am√©liorer la formation</span>
                    </span>
                </h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‚è±Ô∏è Temps total n√©cessaire</label>
                        <select id="temps_total_necessaire">
                            <option value="">S√©lectionner...</option>
                            <option value="< 30 min">Moins de 30 minutes</option>
                            <option value="30-60 min">30 √† 60 minutes</option>
                            <option value="60-90 min">60 √† 90 minutes</option>
                            <option value="90-120 min">90 √† 120 minutes</option>
                            <option value="> 120 min">Plus de 120 minutes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üòä Niveau de satisfaction g√©n√©ral</label>
                        <select id="niveau_satisfaction">
                            <option value="">√âvaluer...</option>
                            <option value="Tr√®s insatisfait">üòû Tr√®s insatisfait</option>
                            <option value="Insatisfait">üòï Insatisfait</option>
                            <option value="Neutre">üòê Neutre</option>
                            <option value="Satisfait">üòä Satisfait</option>
                            <option value="Tr√®s satisfait">üòÉ Tr√®s satisfait</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>üî• √âtape la plus difficile</label>
                        <select id="etape_la_plus_difficile">
                            <option value="">S√©lectionner...</option>
                            <option value="Configuration initiale">Configuration initiale (Git, VS Code)</option>
                            <option value="Appel API">Comprendre et impl√©menter fetch()</option>
                            <option value="Manipulation DOM">S√©lection et modification d'√©l√©ments</option>
                            <option value="Gestion d'erreurs">Try/catch et messages utilisateur</option>
                            <option value="CSS Responsive">Adaptation mobile et design</option>
                            <option value="Git/GitHub">Workflow Git et commits</option>
                            <option value="GitHub Pages">D√©ploiement et configuration</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‚ú® √âtape la plus int√©ressante</label>
                        <select id="etape_la_plus_interessante">
                            <option value="">S√©lectionner...</option>
                            <option value="D√©couverte API">Premier contact avec les APIs</option>
                            <option value="JavaScript asynchrone">Async/await et Promises</option>
                            <option value="Design CSS">Cr√©ation de l'interface</option>
                            <option value="Interactivit√©">Event listeners et interactions</option>
                            <option value="D√©ploiement">Mise en ligne du projet</option>
                            <option value="Gestion d'erreurs">Robustesse de l'application</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>üìñ Utilit√© des commentaires et guides</label>
                        <select id="utilite_des_commentaires">
                            <option value="">√âvaluer...</option>
                            <option value="Inutiles">üò§ Inutiles (trop verbeux)</option>
                            <option value="Peu utiles">üòï Peu utiles</option>
                            <option value="Utiles">üòä Utiles</option>
                            <option value="Tr√®s utiles">üòÉ Tr√®s utiles</option>
                            <option value="Indispensables">ü§© Indispensables</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìã Clart√© des instructions</label>
                        <select id="clarte_des_instructions">
                            <option value="">√âvaluer...</option>
                            <option value="Tr√®s confuses">üòµ Tr√®s confuses</option>
                            <option value="Confuses">üòï Parfois confuses</option>
                            <option value="Correctes">üòê Correctes</option>
                            <option value="Claires">üòä Claires</option>
                            <option value="Tr√®s claires">ü§© Tr√®s claires</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>üë• Recommanderiez-vous cet exercice √† d'autres √©tudiants ?</label>
                    <select id="recommanderiez_exercice">
                        <option value="">Donner votre avis...</option>
                        <option value="Certainement pas">‚ùå Certainement pas</option>
                        <option value="Probablement pas">üòï Probablement pas</option>
                        <option value="Peut-√™tre">ü§∑ Peut-√™tre</option>
                        <option value="Probablement">üòä Probablement</option>
                        <option value="Certainement">‚úÖ Certainement</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üí° Suggestions d'am√©lioration</label>
                    <textarea id="suggestions_amelioration" placeholder="Comment pourrait-on am√©liorer cet exercice pour les prochains √©tudiants ?" maxlength="1000"></textarea>
                    <small style="color: #6b7280;">Vos id√©es pour optimiser la formation</small>
                </div>
            </div>

            <!-- Section M√©ta-donn√©es -->
            <div class="section" id="meta-section">
                <h2>üìã <span>Informations Compl√©mentaires</span></h2>
                <div class="form-group">
                    <label>‚è±Ô∏è Dur√©e de cette √©valuation (minutes)</label>
                    <input type="number" id="duree_evaluation" placeholder="Temps pass√© sur ce formulaire" min="1" max="120">
                    <small style="color: #6b7280;">Estimation du temps pour remplir ce formulaire</small>
                </div>

                <div class="form-group">
                    <label>üõ†Ô∏è Outils et ressources utilis√©s pendant la mission</label>
                    <div class="checkbox-group outils-multi-col" id="outils-container"></div>
                </div>

                <div class="form-group">
                    <label>üìù Observations g√©n√©rales</label>
                    <textarea id="observations" placeholder="Commentaires libres sur votre exp√©rience d'apprentissage..." maxlength="1000"></textarea>
                    <small style="color: #6b7280;">Tout ce que vous souhaitez partager</small>
                </div>
            </div>

            <!-- Section Export -->
            <div class="section" id="export-section">
                <h2>üíæ <span>Export des R√©sultats</span></h2>
                <p style="margin-bottom: 1rem; color: #6b7280;">
                    G√©n√©rez le fichier JSON avec vos r√©ponses pour l'√©valuation finale.
                </p>
                <div class="json-output" id="json-output">
                    Cliquez sur "G√©n√©rer JSON" pour voir le r√©sultat de votre √©valuation...
                </div>
            </div>
        </div>

        <div class="actions">
            <button onclick="validateForm()" class="btn btn-secondary">
                ‚úÖ Valider le formulaire
            </button>
            <button onclick="generateJSON()" class="btn">
                üîÑ G√©n√©rer JSON
            </button>
            <button onclick="copyJSON()" class="btn btn-success">
                üìã Copier JSON
            </button>
            <button onclick="resetForm()" class="btn btn-secondary" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                üîÑ R√©initialiser
            </button>
        </div>
    </div>

    <script>
        // Configuration des donn√©es
        const QCM_DATA = {
            debutant: [
                {q: "Quelle m√©thode JavaScript permet de faire un appel API asynchrone moderne ?", options: ["fetch()", "call()", "request()", "api()"], correct: "fetch()", pts: 1},
                {q: "Que signifie l'acronyme API ?", options: ["Application Programming Interface", "Automated Program Interface", "Advanced Programming Interface", "Application Process Interface"], correct: "Application Programming Interface", pts: 1},
                {q: "Comment r√©cup√®re-t-on un √©l√©ment HTML par son ID en JavaScript ?", options: ["document.getElementById('monId')", "document.getElement('monId')", "getElementById('monId')", "document.find('#monId')"], correct: "document.getElementById('monId')", pts: 1}
            ],
            intermediaire: [
                {q: "Comment g√®re-t-on une erreur avec la m√©thode fetch() ?", options: ["try...catch avec async/await", "error() callback", "fail() method", "exception handler"], correct: "try...catch avec async/await", pts: 2},
                {q: "Quelle balise HTML est s√©mantiquement correcte pour afficher une citation ?", options: ["<blockquote>", "<cite>", "<quote>", "<div class='citation'>"], correct: "<blockquote>", pts: 2},
                {q: "Que fait la commande 'git push origin main' ?", options: ["Envoie les commits locaux vers le repository distant", "R√©cup√®re les modifications du serveur", "Cr√©e une nouvelle branche main", "Supprime les fichiers du repository"], correct: "Envoie les commits locaux vers le repository distant", pts: 2}
            ],
            avance: [
                {q: "Que retourne l'API quotable.io dans sa r√©ponse JSON ?", options: ["Un objet avec les propri√©t√©s content, author et length", "Du texte brut sans formatage", "Un fichier XML structur√©", "Une image avec le texte de la citation"], correct: "Un objet avec les propri√©t√©s content, author et length", pts: 3},
                {q: "Quelle est la diff√©rence principale entre .then() et async/await ?", options: ["async/await offre une syntaxe plus lisible pour le code asynchrone", ".then() est plus performant", "async/await ne g√®re pas les erreurs", "Il n'y a aucune diff√©rence fonctionnelle"], correct: "async/await offre une syntaxe plus lisible pour le code asynchrone", pts: 3},
                {q: "Pourquoi utilise-t-on textContent plut√¥t que innerHTML pour afficher du texte utilisateur ?", options: ["Pour √©viter les injections XSS et les failles de s√©curit√©", "textContent est plus rapide", "innerHTML ne fonctionne pas avec du texte", "C'est une pr√©f√©rence de style de code"], correct: "Pour √©viter les injections XSS et les failles de s√©curit√©", pts: 3}
            ]
        };

        const TECH_DATA = {
            obligatoire: [
                {id: "appel_api_fonctionnel", label: "üì° Appel API avec fetch() r√©ussi", pts: 3},
                {id: "affichage_citation", label: "üìÑ Affichage citation et auteur", pts: 2},
                {id: "gestion_erreurs", label: "‚ö†Ô∏è Gestion des erreurs r√©seau", pts: 3},
                {id: "design_responsive", label: "üì± Design responsive mobile/desktop", pts: 2},
                {id: "interactivite_bouton", label: "üîÑ Bouton nouvelle citation fonctionnel", pts: 2},
                {id: "github_pages_deploye", label: "üöÄ Site d√©ploy√© sur GitHub Pages", pts: 3}
            ],
            bonus: [
                {id: "partage_social", label: "üì§ Partage social ou presse-papiers", pts: 2},
                {id: "favoris_localstorage", label: "‚≠ê Syst√®me de favoris avec localStorage", pts: 3},
                {id: "animations_css", label: "üé® Animations et transitions CSS", pts: 1},
                {id: "raccourcis_clavier", label: "‚å®Ô∏è Raccourcis clavier (ex: Espace)", pts: 1},
                {id: "accessibilite", label: "‚ôø Am√©liorations d'accessibilit√©", pts: 2}
            ]
        };

        const ETAPES_DATA = [
            {id: "etape_1_appel_api", label: "√âtape 1: Impl√©mentation de l'appel API"},
            {id: "etape_2_affichage_dom", label: "√âtape 2: Affichage des donn√©es dans le DOM"},
            {id: "etape_3_gestion_erreurs", label: "√âtape 3: Gestion des erreurs et cas d'exception"},
            {id: "etape_4_evenements", label: "√âtape 4: √âv√©nements et interactivit√©"},
            {id: "bonus_fonctionnalites", label: "Bonus: Fonctionnalit√©s avanc√©es"}
        ];

        const CONCEPTS_DATA = [
            {id: "fetch_api", label: "üåê Fetch API"},
            {id: "async_await", label: "‚è≥ Async/Await"},
            {id: "manipulation_dom", label: "üé® Manipulation DOM"},
            {id: "gestion_erreurs", label: "‚ö†Ô∏è Gestion d'erreurs"},
            {id: "event_listeners", label: "üñ±Ô∏è Event Listeners"},
            {id: "git_github", label: "üìö Git/GitHub"},
            {id: "html_semantique", label: "üìÑ HTML S√©mantique"},
            {id: "css_responsive", label: "üì± CSS Responsive"}
        ];

        const OUTILS_DATA = [
            {id: "formulaire_web", label: "üìã Formulaire web d'√©valuation"},
            {id: "editeur_code", label: "üíª VS Code / √âditeur de code"},
            {id: "navigateur_dev", label: "üîß DevTools navigateur (F12)"},
            {id: "github_desktop", label: "üêô GitHub Desktop"},
            {id: "terminal", label: "‚å®Ô∏è Terminal / Ligne de commande"},
            {id: "documentation", label: "üìñ Documentation officielle (MDN, etc.)"},
            {id: "stack_overflow", label: "ü§ù Stack Overflow"},
            {id: "youtube", label: "üì∫ Tutoriels YouTube"},
            {id: "aide_formateur", label: "üë®‚Äçüè´ Aide du formateur"},
            {id: "entraide_etudiants", label: "üë• Entraide entre √©tudiants"},
            {id: "presentation_atelier", label: "üéì Pr√©sentation atelier (slides)"},
            {id: "debug_guide", label: "üîß Guide de d√©bogage F12"},
            {id: "script_indices", label: "üí° Script avec syst√®me d'indices"},
            {id: "evaluation_form", label: "üìä Formulaire d'auto-√©valuation"}
        ];

        // Variables globales
        let formValidated = false;
        let autoSaveTimer;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            generateQCM();
            generateTechnical();
            generateEtapes();
            generateConcepts();
            generateOutils();
            loadData();
            setupAutoSave();
            updateProgress();
        });

        // G√©n√©ration dynamique du QCM
        function generateQCM() {
            const container = document.getElementById('qcm-container');
            let html = '';
            let qIndex = 1;

            Object.entries(QCM_DATA).forEach(([level, questions]) => {
                const levelName = level.charAt(0).toUpperCase() + level.slice(1);
                const totalPts = questions.reduce((sum, q) => sum + q.pts, 0);
                html += `<h3>${levelName} (${totalPts} pts)</h3>`;
                
                questions.forEach((question, i) => {
                    const isLongOptions = question.options.some(opt => opt.length > 30);
                    const gridClass = isLongOptions ? 'radio-group' : 'compact-options';
                    
                    html += `<div class="qcm-question">
                        <h4>Q${qIndex}. ${question.q} 
                            <span style="color: #6b7280; font-weight: normal;">(${question.pts} pt${question.pts>1?'s':''})</span>
                        </h4>
                        <div class="${gridClass}">`;
                    
                    question.options.forEach(option => {
                        // Mise en forme sp√©ciale pour la Q5 (balises HTML)
                        let displayOption = option;
                        if (question.q.includes('balise HTML')) {
                            displayOption = `<code style='font-family:monospace;background:#f3f4f6;padding:2px 6px;border-radius:4px;'>${option.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</code>`;
                        }
                        html += `<label class="radio-item">
                            <input type="radio" name="q${qIndex}" value="${option}" onchange="updateProgress()"> 
                            <span style="flex: 1;">${displayOption}</span>
                        </label>`;
                    });
                    
                    html += `</div>
                        <textarea id="q${qIndex}_justification" placeholder="üí≠ Justifiez votre choix (optionnel mais recommand√© pour valider votre compr√©hension)..." style="margin-top: 1rem;" maxlength="300"></textarea>
                    </div>`;
                    qIndex++;
                });
            });
            container.innerHTML = html;
        }

        // G√©n√©ration des checkboxes techniques
        function generateTechnical() {
            ['obligatoire', 'bonus'].forEach(type => {
                const container = document.getElementById(`${type}-container`);
                container.innerHTML = TECH_DATA[type].map(item => 
                    `<label class="checkbox-item" onclick="updateScore(); updateProgress();">
                        <input type="checkbox" id="${item.id}" onchange="updateScore(); updateProgress();"> 
                        <div>
                            <strong>${item.label}</strong> 
                            <div style="color: #6b7280; font-size: 0.875rem;">${item.pts} point${item.pts>1?'s':''}</div>
                        </div>
                    </label>`
                ).join('');
            });
        }

        // G√©n√©ration des √©tapes de progression
        function generateEtapes() {
            const container = document.getElementById('etapes-container');
            container.innerHTML = ETAPES_DATA.map(etape => 
                `<div class="etape-item">
                    <h4>${etape.label}</h4>
                    <label class="checkbox-item">
                        <input type="checkbox" id="${etape.id}_terminee" onchange="updateProgress()"> 
                        <strong>√âtape termin√©e</strong>
                    </label>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üòä Difficult√© ressentie</label>
                            <select id="${etape.id}_difficulte_per√ßue" onchange="updateProgress()">
                                <option value="">√âvaluer...</option>
                                <option value="Tr√®s facile">üòä Tr√®s facile</option>
                                <option value="Facile">üôÇ Facile</option>
                                <option value="Moyen">üòê Moyen</option>
                                <option value="Difficile">üòì Difficile</option>
                                <option value="Tr√®s difficile">üòµ Tr√®s difficile</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‚è±Ô∏è Temps approximatif</label>
                            <select id="${etape.id}_temps_passe" onchange="updateProgress()">
                                <option value="">Estimer...</option>
                                <option value="< 5 min">‚ö° Moins de 5 minutes</option>
                                <option value="5-15 min">üèÉ 5 √† 15 minutes</option>
                                <option value="15-30 min">üö∂ 15 √† 30 minutes</option>
                                <option value="30-60 min">üêå 30 √† 60 minutes</option>
                                <option value="> 60 min">üê¢ Plus de 60 minutes</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>üÜò Aide n√©cessaire</label>
                        <textarea id="${etape.id}_aide_necessaire" placeholder="Documentation consult√©e, aide du formateur, outils utilis√©s..." maxlength="300"></textarea>
                    </div>
                </div>`
            ).join('');
        }

        // G√©n√©ration des concepts ma√Ætris√©s
        function generateConcepts() {
            const container = document.getElementById('concepts-container');
            container.innerHTML = CONCEPTS_DATA.map(concept => 
                `<div class="form-group">
                    <label>${concept.label}</label>
                    <select id="${concept.id}" onchange="updateProgress()">
                        <option value="">Auto-√©valuation...</option>
                        <option value="Non ma√Ætris√©">‚ùå Non ma√Ætris√©</option>
                        <option value="Partiellement ma√Ætris√©">üü° Partiellement ma√Ætris√©</option>
                        <option value="Bien ma√Ætris√©">‚úÖ Bien ma√Ætris√©</option>
                        <option value="Parfaitement ma√Ætris√©">üåü Parfaitement ma√Ætris√©</option>
                    </select>
                </div>`
            ).join('');
        }

        // G√©n√©ration des outils utilis√©s
        function generateOutils() {
            const container = document.getElementById('outils-container');
            container.innerHTML = OUTILS_DATA.map(outil => 
                `<label class="checkbox-item">
                    <input type="checkbox" id="${outil.id}" onchange="updateProgress()"> 
                    <span>${outil.label}</span>
                </label>`
            ).join('');
        }

        // Calcul et affichage du score
        function updateScore() {
            let totalQCM = 0;
            let totalTech = 0;
            
            // Score QCM
            let qIndex = 1;
            Object.values(QCM_DATA).flat().forEach(question => {
                const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                if (selected && selected.value === question.correct) totalQCM += question.pts;
                qIndex++;
            });
            
            // Score technique
            [...TECH_DATA.obligatoire, ...TECH_DATA.bonus].forEach(item => {
                const checkbox = document.getElementById(item.id);
                if (checkbox && checkbox.checked) totalTech += item.pts;
            });
            
            const totalScore = totalQCM + totalTech;
            const note20 = Math.round(totalScore * 20 / 42);
            
            const obligatoireScore = TECH_DATA.obligatoire.reduce((total, item) => {
                const checkbox = document.getElementById(item.id);
                return total + (checkbox && checkbox.checked ? item.pts : 0);
            }, 0);
            
            const bonusScore = TECH_DATA.bonus.reduce((total, item) => {
                const checkbox = document.getElementById(item.id);
                return total + (checkbox && checkbox.checked ? item.pts : 0);
            }, 0);
            
            document.getElementById('score-display').innerHTML = `
                <div style="font-size: 1.3rem; margin-bottom: 1rem;">
                    Score Total: <strong>${totalScore}/42 points</strong> (${note20}/20)
                </div>
                <div class="score-details">
                    <div class="score-item">
                        <div style="font-weight: 600; color: #3b82f6;">QCM</div>
                        <div>${totalQCM}/21 pts</div>
                    </div>
                    <div class="score-item">
                        <div style="font-weight: 600; color: #10b981;">Obligatoire</div>
                        <div>${obligatoireScore}/15 pts</div>
                    </div>
                    <div class="score-item">
                        <div style="font-weight: 600; color: #f59e0b;">Bonus</div>
                        <div>${bonusScore}/9 pts</div>
                    </div>
                </div>
            `;
        }

        // Mise √† jour de la barre de progression
        function updateProgress() {
            let totalFields = 0;
            let filledFields = 0;
            
            // Compter les champs remplis
            document.querySelectorAll('input, select, textarea').forEach(field => {
                if (field.type !== 'button' && field.id) {
                    totalFields++;
                    if (field.type === 'checkbox' || field.type === 'radio') {
                        if (field.checked) filledFields++;
                    } else if (field.value.trim()) {
                        filledFields++;
                    }
                }
            });
            
            const progress = Math.round((filledFields / totalFields) * 100);
            document.getElementById('progressBar').style.width = progress + '%';
            
            updateScore();
        }

        // Validation du formulaire
        function validateForm() {
            const errors = [];
            
            // V√©rifier QCM
            let qIndex = 1;
            Object.values(QCM_DATA).flat().forEach(() => {
                const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                if (!selected) {
                    errors.push(`Question ${qIndex} non r√©pondue`);
                }
                qIndex++;
            });
            
            // V√©rifier au moins une fonctionnalit√© technique
            const anyTechChecked = [...TECH_DATA.obligatoire, ...TECH_DATA.bonus].some(item => {
                const checkbox = document.getElementById(item.id);
                return checkbox && checkbox.checked;
            });
            
            if (!anyTechChecked) {
                errors.push("Aucune fonctionnalit√© technique coch√©e");
            }
            
            if (errors.length === 0) {
                formValidated = true;
                alert('‚úÖ Formulaire valid√© avec succ√®s ! Vous pouvez maintenant g√©n√©rer le JSON.');
            } else {
                alert('‚ùå Erreurs trouv√©es :\n' + errors.join('\n'));
            }
        }

        // G√©n√©ration JSON
        function generateJSON() {
            if (!formValidated) {
                if (!confirm('‚ö†Ô∏è Formulaire non valid√©. G√©n√©rer le JSON quand m√™me ?')) {
                    return;
                }
            }
            
            const data = {
                etudiant: {
                    nom: "[√Ä REMPLIR PAR SCRIPT DE COLLECTE]",
                    prenom: "[√Ä REMPLIR PAR SCRIPT DE COLLECTE]", 
                    classe: "BTS2-SIO-SLAM",
                    date: "[√Ä REMPLIR PAR SCRIPT DE COLLECTE]",
                    duree_seance: "90min",
                    github_repository: "[√Ä REMPLIR PAR SCRIPT DE COLLECTE]",
                    github_pages_url: "[√Ä REMPLIR PAR SCRIPT DE COLLECTE]"
                },
                qcm_niveau_debutant: {},
                qcm_niveau_intermediaire: {},
                qcm_niveau_avance: {},
                evaluation_technique: {
                    fonctionnalites_implementees: {},
                    bonus_optionnels: {}
                },
                auto√©valuation_progression: {
                    etapes_completees: {},
                    concepts_maitrises: {},
                    concepts_a_revoir: getValue('concepts_a_revoir').split(',').map(s => s.trim()).filter(s => s),
                    difficultes_rencontrees: getValue('difficultes_rencontrees').split(',').map(s => s.trim()).filter(s => s),
                    points_forts_identifies: getValue('points_forts_identifies').split(',').map(s => s.trim()).filter(s => s),
                    ameliorations_souhaitees: getValue('ameliorations_souhaitees').split(',').map(s => s.trim()).filter(s => s)
                },
                reflexion_pedagogique: {
                    temps_total_necessaire: getValue('temps_total_necessaire'),
                    etape_la_plus_difficile: getValue('etape_la_plus_difficile'),
                    etape_la_plus_interessante: getValue('etape_la_plus_interessante'),
                    utilite_des_commentaires: getValue('utilite_des_commentaires'),
                    clarte_des_instructions: getValue('clarte_des_instructions'),
                    suggestions_amelioration: getValue('suggestions_amelioration'),
                    niveau_satisfaction: getValue('niveau_satisfaction'),
                    recommanderiez_exercice: getValue('recommanderiez_exercice')
                },
                evaluation_formateur: {
                    qualite_code: { organisation: "", commentaires: "", bonnes_pratiques: "", note: "" },
                    comprehension_concepts: { api_rest: "", javascript_asynchrone: "", manipulation_dom: "", note: "" },
                    autonomie: { recherche_solutions: "", gestion_erreurs: "", debugging: "", note: "" },
                    commentaires_generaux: "",
                    points_a_ameliorer: [],
                    felicitations: []
                },
                grille_notation: {
                    qcm_debutant: { total_points: 3, points_obtenus: calculateQCMScore('debutant') },
                    qcm_intermediaire: { total_points: 6, points_obtenus: calculateQCMScore('intermediaire') },
                    qcm_avance: { total_points: 9, points_obtenus: calculateQCMScore('avance') },
                    technique_obligatoire: { total_points: 15, points_obtenus: calculateTechniqueScore('obligatoire') },
                    bonus_optionnel: { total_points: 9, points_obtenus: calculateTechniqueScore('bonus') },
                    note_finale: { total_sur_20: calculateFinalScore(), appreciation: getAppreciation(calculateTotalScore()) }
                },
                meta_evaluation: {
                    date_evaluation: new Date().toISOString().split('T')[0],
                    evaluateur: getValue('evaluateur') || 'Auto-√©valuation √©tudiant',
                    duree_evaluation: getValue('duree_evaluation') + ' minutes',
                    outils_utilises: getSelectedTools(),
                    observations: getValue('observations')
                }
            };

            // Remplir QCM
            let qIndex = 1;
            Object.entries(QCM_DATA).forEach(([level, questions]) => {
                const sectionKey = `qcm_niveau_${level}`;
                questions.forEach((question, i) => {
                    const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                    const justification = document.getElementById(`q${qIndex}_justification`);
                    
                    data[sectionKey][`q${qIndex}`] = {
                        question: question.q,
                        reponse: selected ? selected.value : '',
                        options: question.options,
                        justification: justification ? justification.value : '',
                        points: question.pts,
                        concept: getConceptForLevel(level)
                    };
                    qIndex++;
                });
            });

            // Remplir technique
            TECH_DATA.obligatoire.forEach(item => {
                const checkbox = document.getElementById(item.id);
                data.evaluation_technique.fonctionnalites_implementees[item.id] = {
                    realise: checkbox ? checkbox.checked : false,
                    points: item.pts,
                    commentaire: ""
                };
            });

            TECH_DATA.bonus.forEach(item => {
                const checkbox = document.getElementById(item.id);
                data.evaluation_technique.bonus_optionnels[item.id] = {
                    realise: checkbox ? checkbox.checked : false,
                    points: item.pts,
                    commentaire: ""
                };
            });

            // Remplir √©tapes et concepts
            ETAPES_DATA.forEach(etape => {
                data.auto√©valuation_progression.etapes_completees[etape.id] = {
                    terminee: getValue(`${etape.id}_terminee`),
                    difficulte_per√ßue: getValue(`${etape.id}_difficulte_per√ßue`),
                    temps_passe: getValue(`${etape.id}_temps_passe`),
                    aide_necessaire: getValue(`${etape.id}_aide_necessaire`)
                };
            });

            CONCEPTS_DATA.forEach(concept => {
                data.auto√©valuation_progression.concepts_maitrises[concept.id] = getValue(concept.id);
            });

            document.getElementById('json-output').textContent = JSON.stringify(data, null, 2);
            
            // Scroll vers le JSON
            document.getElementById('export-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Fonctions utilitaires
        function getValue(id) {
            const element = document.getElementById(id);
            if (!element) return '';
            return element.type === 'checkbox' ? element.checked : element.value;
        }

        function getSelectedTools() {
            return OUTILS_DATA.filter(outil => {
                const checkbox = document.getElementById(outil.id);
                return checkbox && checkbox.checked;
            }).map(outil => outil.label);
        }

        function getConceptForLevel(level) {
            const concepts = {
                'debutant': 'API/DOM de base',
                'intermediaire': 'JavaScript/Git interm√©diaire', 
                'avance': 'S√©curit√©/Bonnes pratiques'
            };
            return concepts[level] || 'G√©n√©ral';
        }

        function calculateQCMScore(niveau) {
            let qIndex = 1;
            let score = 0;
            
            Object.entries(QCM_DATA).forEach(([level, questions]) => {
                if (level === niveau) {
                    questions.forEach(question => {
                        const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                        if (selected && selected.value === question.correct) score += question.pts;
                        qIndex++;
                    });
                } else {
                    qIndex += questions.length;
                }
            });
            
            return score;
        }

        function calculateTechniqueScore(type) {
            return TECH_DATA[type].reduce((total, item) => {
                const checkbox = document.getElementById(item.id);
                return total + (checkbox && checkbox.checked ? item.pts : 0);
            }, 0);
        }

        function calculateTotalScore() {
            let total = 0;
            let qIndex = 1;
            Object.values(QCM_DATA).flat().forEach(question => {
                const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                if (selected && selected.value === question.correct) total += question.pts;
                qIndex++;
            });
            [...TECH_DATA.obligatoire, ...TECH_DATA.bonus].forEach(item => {
                const checkbox = document.getElementById(item.id);
                if (checkbox && checkbox.checked) total += item.pts;
            });
            return total;
        }

        function calculateFinalScore() {
            return Math.round(calculateTotalScore() * 20 / 42);
        }

        function getAppreciation(score) {
            const note20 = Math.round(score * 20 / 42);
            if (note20 >= 18) return "üåü Excellent";
            if (note20 >= 16) return "üòÉ Tr√®s bien";
            if (note20 >= 14) return "üòä Bien";
            if (note20 >= 12) return "üôÇ Assez bien";
            if (note20 >= 10) return "üòê Passable";
            return "üòû Insuffisant";
        }

        function copyJSON() {
            const text = document.getElementById('json-output').textContent;
            if (!text || text.includes('Cliquez')) {
                alert('‚ö†Ô∏è G√©n√©rez d\'abord le JSON !');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showAutoSaveIndicator('üìã JSON copi√© dans le presse-papiers !');
            }).catch(() => {
                alert('‚ùå Erreur de copie. S√©lectionnez manuellement le texte.');
            });
        }

        function resetForm() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir r√©initialiser tout le formulaire ?')) {
                localStorage.removeItem('evaluation-data');
                location.reload();
            }
        }

        // Auto-sauvegarde
        function setupAutoSave() {
            document.addEventListener('input', saveData);
            document.addEventListener('change', saveData);
        }

        function saveData() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                const data = {};
                document.querySelectorAll('input, select, textarea').forEach(el => {
                    if (el.id) {
                        if (el.type === 'checkbox') data[el.id] = el.checked;
                        else data[el.id] = el.value;
                    }
                    if (el.name && el.type === 'radio' && el.checked) data[el.name] = el.value;
                });
                localStorage.setItem('evaluation-data', JSON.stringify(data));
                showAutoSaveIndicator();
            }, 1000);
        }

        function loadData() {
            try {
                const data = JSON.parse(localStorage.getItem('evaluation-data') || '{}');
                Object.entries(data).forEach(([key, value]) => {
                    const el = document.getElementById(key) || document.querySelector(`input[name="${key}"]`);
                    if (el) {
                        if (el.type === 'checkbox') el.checked = value;
                        else if (el.type === 'radio' && el.value === value) el.checked = true;
                        else el.value = value;
                    }
                });
                updateScore();
                updateProgress();
            } catch (e) {
                console.warn('Erreur chargement localStorage:', e);
            }
        }

        function showAutoSaveIndicator(message = 'üíæ Sauvegard√©') {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.textContent = message;
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
    </script>
</body>
</html>